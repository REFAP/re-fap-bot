<!doctype html><meta charset="utf-8">
<title>Test SSE</title>
<body style="font-family:system-ui;margin:2rem">
  <h1>Test SSE</h1>
  <p><a href="/healthz">healthz</a></p>
  <form id="f">
    <input id="q" placeholder="symptôme..." size="60">
    <button>Envoyer</button>
  </form>
  <pre id="out"></pre>
  <script>
    document.getElementById("f").onsubmit = (e) => {
      e.preventDefault();
      const q = document.getElementById("q").value.trim();
      const es = new EventSource(`/api/diagnose/stream?q=${encodeURIComponent(q)}`);
      const out = document.getElementById("out");
      out.textContent = "";
      es.onmessage = (ev) => {
        const data = JSON.parse(ev.data);
        if (data.delta) out.textContent += data.delta;
        if (data.done || data.error) es.close();
      };
    };
  </script>
</body>
